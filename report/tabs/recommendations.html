<!-- Recommendations Tab Content -->
<div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-900 mb-2">Recommendations</h2>
    <p class="text-gray-600">Prioritized action plan</p>
</div>

<!-- Priority 1: React2Shell Critical Vulnerability -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-red-700 to-red-900">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 1: React2Shell Critical Vulnerability (CVE-2025-55182)</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">IMMEDIATE</span>
        </div>
    </div>
    <div class="p-6">
        <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <div>
                    <div class="font-bold text-red-800">Critical Remote Code Execution Vulnerability</div>
                    <div class="text-sm text-red-700 mt-1">React2Shell enables unintended remote code execution in React Server Components when specially crafted requests are sent to affected systems. This is actively being exploited in the wild.</div>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-bold text-gray-900 mb-2">CVE Identifiers</h4>
                <ul class="space-y-1 text-sm">
                    <li><span class="font-mono bg-red-100 text-red-800 px-2 py-0.5 rounded">CVE-2025-55182</span> React 19</li>
                    <li><span class="font-mono bg-red-100 text-red-800 px-2 py-0.5 rounded">CVE-2025-66478</span> Next.js</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-bold text-gray-900 mb-2">Affected Versions</h4>
                <ul class="space-y-1 text-sm text-gray-700">
                    <li>• Next.js 15.0.0 - 16.0.6</li>
                    <li>• Next.js 14 canary after 14.3.0-canary.76</li>
                    <li>• react-server-dom-webpack</li>
                    <li>• react-server-dom-turbopack</li>
                </ul>
            </div>
        </div>

        <div class="mb-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
            <h4 class="font-bold text-amber-800 mb-2">Consequences if Unpatched</h4>
            <ul class="space-y-1 text-sm text-amber-900">
                <li>• <strong>Remote Code Execution:</strong> Attackers can execute arbitrary code on your Vercel server</li>
                <li>• <strong>Data Breach:</strong> Full access to environment variables, API keys, database credentials</li>
                <li>• <strong>System Compromise:</strong> Vercel advises to "assume your vulnerable systems are potentially compromised"</li>
                <li>• <strong>Lateral Movement:</strong> Attackers can pivot to connected services (Supabase, Stripe, Meta, etc.)</li>
                <li>• <strong>Financial Impact:</strong> Unauthorized charges via exposed Stripe keys, AI API abuse</li>
            </ul>
        </div>

        <h4 class="font-bold text-gray-900 mb-3">Required Actions</h4>
        <div class="space-y-3">
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <div class="font-medium">Merge Vercel automated security PR</div>
                    <div class="text-sm text-gray-500">
                        <a href="https://github.com/systemstoscale/adspend-ai/pull/79" target="_blank" rel="noopener" class="text-blue-600 hover:underline font-mono">PR #79: Fix React Server Components RCE vulnerability</a>
                        <span class="ml-2 px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs">Auto-generated by Vercel</span>
                    </div>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <div class="font-medium">Verify package versions after merge</div>
                    <div class="text-sm text-gray-500">Check package.json for Next.js ≥15.0.5, ≥15.1.9, or ≥15.2.6</div>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <div class="font-medium">Enable Vercel Standard Protection</div>
                    <div class="text-sm text-gray-500">Prevents unauthorized access to preview deployments</div>
                </div>
            </div>
            <div class="checklist-item">
                <div class="checklist-box"></div>
                <div>
                    <div class="font-medium">Enable Vercel WAF filtering</div>
                    <div class="text-sm text-gray-500">Provides temporary protection against known exploit patterns</div>
                </div>
            </div>
        </div>

        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
            <div class="text-sm text-blue-800">
                <strong>Reference:</strong> <a href="https://vercel.com/kb/bulletin/react2shell" target="_blank" rel="noopener" class="underline hover:text-blue-600">https://vercel.com/kb/bulletin/react2shell</a>
            </div>
        </div>
    </div>
</div>

<!-- Priority 2: Other Security Issues -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-red-600 to-red-700">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 2: Additional Security Hardening</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">1-2 weeks</span>
        </div>
    </div>
    <div class="p-6">
        <div class="space-y-6">
            <!-- Item 1: Remove exposed keys -->
            <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-start gap-3">
                    <div class="checklist-box mt-1"></div>
                    <div class="flex-1">
                        <div class="font-bold text-red-800">Remove ALL exposed API keys from .env.example</div>
                        <div class="text-sm text-gray-600 mt-1 mb-2">The following production keys are currently exposed in the repository:</div>
                        <div class="code-block text-xs mb-3">
NEXT_PUBLIC_SUPABASE_URL=https://dfqzfykugnevxawkjxwg.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIs...
SUPABASE_SERVICE_ROLE_KEY=sbp_4eaa2f8a...
OPENAI_API_KEY=sk-proj-N2PiN_-Rkg8EY2yTxwQCo...
ANTHROPIC_API_KEY=sk-ant-api03-nfumBDWswMY05Y3F...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51LgORx...
STRIPE_SECRET_KEY=sk_test_51LgORx...
STRIPE_WEBHOOK_SECRET=whsec_9a3b026ee7de255f...
META_APP_ID=1465619594588516
META_APP_SECRET=d0598e364a70d39c6f30ff636a22e025
ENCRYPTION_KEY=your-32-byte-hex-encryption-key...</div>
                        <div class="p-3 bg-amber-50 border border-amber-200 rounded">
                            <div class="font-semibold text-amber-800 text-sm">Why this matters:</div>
                            <ul class="text-sm text-amber-900 mt-1 space-y-1">
                                <li>• <strong>Financial Loss:</strong> Exposed Stripe keys allow unauthorized charges or refunds</li>
                                <li>• <strong>AI Cost Abuse:</strong> OpenAI/Anthropic keys can be used to run expensive model calls at your expense</li>
                                <li>• <strong>Data Breach:</strong> Supabase service role key bypasses RLS - full database access</li>
                                <li>• <strong>Account Takeover:</strong> Meta API credentials allow access to connected ad accounts</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Item 2: Replace with placeholders -->
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="flex items-start gap-3">
                    <div class="checklist-box mt-1"></div>
                    <div class="flex-1">
                        <div class="font-bold text-gray-800">Replace .env.example secrets with placeholders</div>
                        <div class="text-sm text-gray-600 mt-1 mb-2">Use descriptive placeholder values instead of real credentials:</div>
                        <div class="code-block text-xs mb-3">
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
OPENAI_API_KEY=sk-your-openai-key
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key
STRIPE_SECRET_KEY=sk_test_your-stripe-key
META_APP_SECRET=your-meta-app-secret</div>
                        <div class="text-sm text-gray-500 font-mono">File: /.env.example</div>
                    </div>
                </div>
            </div>

            <!-- Item 3: Admin bypass -->
            <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-start gap-3">
                    <div class="checklist-box mt-1"></div>
                    <div class="flex-1">
                        <div class="font-bold text-yellow-800">Consider removing @adspend.com admin bypass</div>
                        <div class="text-sm text-gray-600 mt-1 mb-2">Currently, any verified @adspend.com email gets automatic admin access:</div>
                        <div class="code-block text-xs mb-3">
<span class="text-gray-400">// /src/middleware.ts:59</span>
if (user.email?.endsWith('@adspend.com')) {
  return true; // Bypasses ALL permission checks
}</div>
                        <div class="p-3 bg-green-50 border border-green-200 rounded">
                            <div class="font-semibold text-green-800 text-sm">Mitigating Factor:</div>
                            <div class="text-sm text-green-700">Email confirmation is required for signup - attackers cannot use fake @adspend.com emails without inbox access. However, a database-backed role system provides better audit trails and granular control.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Item 4: Cookie security -->
            <div class="p-4 bg-orange-50 border border-orange-200 rounded-lg">
                <div class="flex items-start gap-3">
                    <div class="checklist-box mt-1"></div>
                    <div class="flex-1">
                        <div class="font-bold text-orange-800">Add HttpOnly/Secure flags to cookies</div>
                        <div class="text-sm text-gray-600 mt-1 mb-2">Admin impersonation cookies lack critical security flags:</div>
                        <div class="p-3 bg-amber-50 border border-amber-200 rounded mb-2">
                            <div class="font-semibold text-amber-800 text-sm">Why this matters:</div>
                            <ul class="text-sm text-amber-900 mt-1 space-y-1">
                                <li>• <strong>XSS Token Theft:</strong> Without HttpOnly, JavaScript can steal session cookies</li>
                                <li>• <strong>Man-in-the-Middle:</strong> Without Secure flag, cookies transmit over HTTP</li>
                                <li>• <strong>Session Hijacking:</strong> Stolen admin cookies allow full account takeover</li>
                            </ul>
                        </div>
                        <div class="text-sm text-gray-500 font-mono">File: /src/lib/supabase/server.ts</div>
                    </div>
                </div>
            </div>

            <!-- Item 5: CSRF -->
            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-start gap-3">
                    <div class="checklist-box mt-1"></div>
                    <div class="flex-1">
                        <div class="font-bold text-blue-800">Implement CSRF protection</div>
                        <div class="text-sm text-gray-600 mt-1 mb-2">State-changing operations lack CSRF tokens:</div>
                        <div class="p-3 bg-amber-50 border border-amber-200 rounded mb-2">
                            <div class="font-semibold text-amber-800 text-sm">Example Attack Scenario:</div>
                            <ul class="text-sm text-amber-900 mt-1 space-y-1">
                                <li>1. Attacker sends user a link to malicious page</li>
                                <li>2. Page contains hidden form posting to your API</li>
                                <li>3. User's browser sends request with their auth cookies</li>
                                <li>4. API processes request as if user initiated it</li>
                                <li>• <strong>Result:</strong> Attacker can change user's password, delete data, transfer funds</li>
                            </ul>
                        </div>
                        <div class="text-sm text-gray-500">Affects: All mutation endpoints (POST, PUT, DELETE)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Priority 3: Architecture & Tech Debt -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-orange-500 to-orange-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 3: Architecture & Tech Debt</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">2-4 weeks</span>
        </div>
    </div>
    <div class="p-6">
        <div class="space-y-4">
            <div class="p-4 bg-orange-50 border border-orange-200 rounded-lg">
                <div class="font-bold text-orange-800 mb-2">Consolidate duplicate Copywriter pages</div>
                <div class="text-sm text-gray-600 mb-2">Multiple implementations of the same feature cause maintenance burden and inconsistent UX:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• <code class="bg-gray-100 px-1 rounded">/app/copywriter/</code> - Original implementation</li>
                    <li>• <code class="bg-gray-100 px-1 rounded">/app/copywriter-v2/</code> - Refactored version</li>
                    <li>• <strong>Impact:</strong> Bug fixes need to be applied twice, features diverge over time</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Complete v1/v2 offer system migration</div>
                <div class="text-sm text-gray-600 mb-2">The 8P Framework has two parallel implementations:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• v1: Legacy offer structure with flat fields</li>
                    <li>• v2: New JSONB-based structure with versioning</li>
                    <li>• <strong>Risk:</strong> Data inconsistency between versions, complex queries</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Remove blocked routes (dead code in middleware)</div>
                <div class="text-sm text-gray-600">Middleware contains route blocking for paths that no longer exist - creates confusion and potential security blind spots.</div>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Implement API versioning</div>
                <div class="text-sm text-gray-600 mb-2">158 API routes with no versioning strategy:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• <strong>Problem:</strong> Breaking changes affect all clients immediately</li>
                    <li>• <strong>Solution:</strong> Add <code class="bg-gray-100 px-1 rounded">/api/v1/</code> prefix, maintain backward compatibility</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Priority 4: Code Quality -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-yellow-500 to-yellow-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 4: Code Quality</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">Ongoing</span>
        </div>
    </div>
    <div class="p-6">
        <div class="space-y-4">
            <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                <div class="font-bold text-red-800 mb-2">Re-enable TypeScript checks in build</div>
                <div class="text-sm text-gray-600 mb-2">TypeScript strict mode is disabled in next.config.ts:</div>
                <div class="code-block text-xs mb-2">typescript: { ignoreBuildErrors: true }</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• <strong>Risk:</strong> Type errors slip into production undetected</li>
                    <li>• <strong>Impact:</strong> Runtime crashes, undefined behavior, harder debugging</li>
                    <li>• <strong>Fix:</strong> Set to false, fix all type errors before deploying</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Increase test coverage (15 suites currently)</div>
                <div class="text-sm text-gray-600 mb-2">Current testing stack: Vitest + Playwright + Testing Library</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• 500+ TypeScript files with only 15 test suites</li>
                    <li>• Critical paths (auth, payments, AI) need integration tests</li>
                    <li>• <strong>Target:</strong> 80% coverage on business logic</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Consolidate 60+ docs files in /docs</div>
                <div class="text-sm text-gray-600">Large documentation folder with outdated and redundant files. Consolidate into structured README files per feature.</div>
            </div>
        </div>
    </div>
</div>

<!-- Priority 5: Performance -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-blue-500 to-blue-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 5: Performance Optimization</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">4-8 weeks</span>
        </div>
    </div>
    <div class="p-6">
        <div class="space-y-4">
            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="font-bold text-blue-800 mb-2">Add Redis caching layer</div>
                <div class="text-sm text-gray-600 mb-2">Currently no caching for expensive operations:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• AI response caching (exists in DB but slow)</li>
                    <li>• User session data fetched on every request</li>
                    <li>• <strong>Solution:</strong> Vercel KV (Redis) for sub-millisecond reads</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Optimize pgvector search</div>
                <div class="text-sm text-gray-600 mb-2">1536-dimension vectors in knowledge_embeddings:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• Add HNSW index for faster approximate nearest neighbor</li>
                    <li>• Consider dimensionality reduction for large datasets</li>
                    <li>• Implement query result caching</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Review database indexes</div>
                <div class="text-sm text-gray-600">63 tables in public schema - audit frequently queried columns for missing indexes. Use pg_stat_statements to identify slow queries.</div>
            </div>
        </div>
    </div>
</div>

<!-- Priority 6: Modernization -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-purple-500 to-purple-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 6: Next.js Modernization</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">Future</span>
        </div>
    </div>
    <div class="p-6">
        <div class="space-y-4">
            <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                <div class="font-bold text-purple-800 mb-2">Increase React Server Components usage</div>
                <div class="text-sm text-gray-600 mb-2">Many pages still use client-side rendering when server rendering would be more efficient:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• <strong>Benefit:</strong> Reduced JavaScript bundle, faster initial load</li>
                    <li>• <strong>Target:</strong> Dashboard, settings, and static pages</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Adopt Server Actions</div>
                <div class="text-sm text-gray-600 mb-2">Replace API routes with Server Actions where appropriate:</div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li>• Form submissions (offer creation, settings updates)</li>
                    <li>• Simple mutations without complex validation</li>
                    <li>• <strong>Benefit:</strong> Type-safe, no API boilerplate</li>
                </ul>
            </div>
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Implement Streaming UI</div>
                <div class="text-sm text-gray-600">Use Suspense boundaries and streaming for AI chat responses - show partial content as it generates rather than waiting for completion.</div>
            </div>
        </div>
    </div>
</div>

<!-- Priority 7: Observability & Monitoring -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-pink-500 to-pink-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 7: Observability with Sentry.io</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">1-2 weeks</span>
        </div>
    </div>
    <div class="p-6">
        <div class="mb-4 p-4 bg-pink-50 border border-pink-200 rounded-lg">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-pink-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <div>
                    <div class="font-bold text-pink-800">Implement Sentry.io for Error Tracking & Performance Monitoring</div>
                    <div class="text-sm text-pink-700 mt-1">Currently no centralized error tracking - issues go unnoticed until users report them.</div>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="font-bold text-gray-800 mb-2">Why Sentry.io?</div>
                <ul class="text-sm text-gray-700 space-y-2">
                    <li>• <strong>Real-time Error Alerts:</strong> Get notified immediately when errors occur in production</li>
                    <li>• <strong>Full Stack Traces:</strong> See exact line numbers, file paths, and variable values at time of error</li>
                    <li>• <strong>User Context:</strong> Know which user experienced the error, their browser, device, and session</li>
                    <li>• <strong>Release Tracking:</strong> Correlate errors with specific deployments to identify regressions</li>
                    <li>• <strong>Performance Monitoring:</strong> Track slow API routes, database queries, and page loads</li>
                </ul>
            </div>

            <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                <div class="font-bold text-green-800 mb-2">Benefits for AdSpend AI</div>
                <ul class="text-sm text-green-700 space-y-2">
                    <li>• <strong>AI API Failures:</strong> Catch OpenAI/Anthropic timeouts, rate limits, and malformed responses before users notice</li>
                    <li>• <strong>Stripe Webhook Issues:</strong> Alert on failed payment processing, subscription errors, or webhook signature mismatches</li>
                    <li>• <strong>Supabase Connection Issues:</strong> Detect database connection pool exhaustion or RLS policy violations</li>
                    <li>• <strong>Meta API Errors:</strong> Track ad sync failures, token expirations, and rate limiting</li>
                    <li>• <strong>RAG Pipeline Failures:</strong> Monitor embedding generation errors, vector search timeouts, and chunking issues</li>
                </ul>
            </div>

            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="font-bold text-blue-800 mb-2">Implementation Example</div>
                <div class="code-block text-xs mb-2">
<span class="text-gray-400">// Install: npm install @sentry/nextjs</span>

<span class="text-gray-400">// sentry.client.config.ts</span>
import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,
  integrations: [
    Sentry.replayIntegration(),
  ],
});

<span class="text-gray-400">// Usage in API routes:</span>
try {
  const response = await openai.chat.completions.create({...});
} catch (error) {
  Sentry.captureException(error, {
    tags: { provider: 'openai', feature: 'copywriter' },
    extra: { userId, model, promptLength }
  });
  throw error;
}</div>
            </div>

            <div class="p-4 bg-amber-50 border border-amber-200 rounded-lg">
                <div class="font-bold text-amber-800 mb-2">Key Metrics to Track</div>
                <ul class="text-sm text-amber-900 space-y-1">
                    <li>• <strong>Error Rate:</strong> Errors per 1000 requests (target: &lt;1%)</li>
                    <li>• <strong>P95 Latency:</strong> 95th percentile response time (target: &lt;3s for AI, &lt;500ms for CRUD)</li>
                    <li>• <strong>Apdex Score:</strong> User satisfaction index (target: &gt;0.9)</li>
                    <li>• <strong>LCP:</strong> Largest Contentful Paint (target: &lt;2.5s)</li>
                    <li>• <strong>Session Replays:</strong> Record user sessions leading to errors for debugging</li>
                </ul>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
                <div class="p-3 bg-gray-100 rounded-lg text-center">
                    <div class="text-2xl font-bold text-gray-800">Free</div>
                    <div class="text-xs text-gray-500">5K errors/month</div>
                </div>
                <div class="p-3 bg-gray-100 rounded-lg text-center">
                    <div class="text-2xl font-bold text-gray-800">$26/mo</div>
                    <div class="text-xs text-gray-500">50K errors + performance</div>
                </div>
                <div class="p-3 bg-gray-100 rounded-lg text-center">
                    <div class="text-2xl font-bold text-gray-800">$80/mo</div>
                    <div class="text-xs text-gray-500">100K + session replay</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Priority 8: Client Bug Fixes -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-amber-500 to-amber-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 8: Client-Reported Bug Fixes</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">PLACEHOLDER</span>
        </div>
    </div>
    <div class="p-6">
        <div class="mb-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-amber-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <div class="font-bold text-amber-800">Tracking Client-Reported Issues</div>
                    <div class="text-sm text-amber-700 mt-1">This section will be populated with bugs reported by users and clients during testing and production use.</div>
                </div>
            </div>
        </div>
        <div class="space-y-3">
            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg border-dashed">
                <div class="text-center text-gray-500">
                    <div class="font-semibold mb-1">No bugs reported yet</div>
                    <div class="text-sm">Bug reports will be added here as they are received from client testing.</div>
                </div>
            </div>
            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="text-sm text-blue-800">
                    <strong>Bug Tracking Process:</strong> Bugs should include: description, reproduction steps, expected vs actual behavior, affected user(s), severity level, and any screenshots/videos.
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Priority 9: Framework Upgrade -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-indigo-500 to-indigo-600">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Priority 9: Next.js & React Version Upgrade</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">Future</span>
        </div>
    </div>
    <div class="p-6">
        <div class="mb-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-indigo-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <div>
                    <div class="font-bold text-indigo-800">Upgrade to Latest Stable Versions</div>
                    <div class="text-sm text-indigo-700 mt-1">Current: Next.js 15.5.4, React 19.0.0 - Keep pace with framework improvements and security patches.</div>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-bold text-gray-900 mb-2">Current Versions</h4>
                <table class="text-sm w-full">
                    <tr><td class="py-1 text-gray-600">Next.js</td><td class="font-mono">^15.5.4</td></tr>
                    <tr><td class="py-1 text-gray-600">React</td><td class="font-mono">^19.0.0</td></tr>
                    <tr><td class="py-1 text-gray-600">TypeScript</td><td class="font-mono">^5</td></tr>
                    <tr><td class="py-1 text-gray-600">Tailwind</td><td class="font-mono">^4</td></tr>
                </table>
            </div>
            <div class="p-4 bg-green-50 rounded-lg">
                <h4 class="font-bold text-green-800 mb-2">Why Upgrade Regularly?</h4>
                <ul class="text-sm text-green-700 space-y-1">
                    <li>• Security vulnerability patches</li>
                    <li>• Performance improvements</li>
                    <li>• New features and APIs</li>
                    <li>• Better developer experience</li>
                    <li>• Ecosystem compatibility</li>
                </ul>
            </div>
        </div>

        <div class="space-y-3">
            <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="font-bold text-yellow-800 mb-2">Upgrade Considerations</div>
                <ul class="text-sm text-yellow-900 space-y-1">
                    <li>• <strong>Breaking Changes:</strong> Review Next.js and React changelogs before upgrading - major versions may require code changes</li>
                    <li>• <strong>Dependency Compatibility:</strong> Ensure @ai-sdk/*, @supabase/*, and other dependencies support new versions</li>
                    <li>• <strong>Testing:</strong> Run full E2E test suite after upgrade to catch regressions</li>
                    <li>• <strong>Staging First:</strong> Deploy to staging environment before production</li>
                </ul>
            </div>
            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="font-bold text-blue-800 mb-2">Upgrade Command</div>
                <div class="code-block text-xs">
<span class="text-gray-400"># Check for updates</span>
npx npm-check-updates -u --target minor  <span class="text-green-400"># Safe minor updates</span>

<span class="text-gray-400"># Manual upgrade for major versions</span>
npm install next@latest react@latest react-dom@latest

<span class="text-gray-400"># After upgrade - verify build and tests</span>
npm run build && npm run test
                </div>
            </div>
            <div class="p-3 bg-purple-50 border border-purple-200 rounded-lg">
                <div class="text-sm text-purple-800">
                    <strong>Recommended Cadence:</strong> Check for minor/patch updates monthly. Evaluate major version upgrades quarterly. Subscribe to Next.js and React release notes for critical security updates.
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Additional Security Vulnerabilities Reference -->
<div class="card mb-6">
    <div class="section-header bg-gradient-to-r from-gray-600 to-gray-700">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold">Full Security Vulnerability Reference</h3>
            <span class="px-3 py-1 bg-white/20 rounded-full text-sm">27 Total</span>
        </div>
    </div>
    <div class="p-6">
        <div class="mb-4">
            <h4 class="font-bold text-orange-800 mb-3">High Severity (8 vulnerabilities)</h4>
            <div class="grid md:grid-cols-2 gap-3">
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">No CSRF Protection</div>
                    <div class="text-xs text-orange-700">State-changing operations vulnerable to cross-site request forgery attacks</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">Zero Rate Limiting</div>
                    <div class="text-xs text-orange-700">No Redis backing - unlimited API abuse, DoS, and credential stuffing possible</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">IDOR Vulnerabilities</div>
                    <div class="text-xs text-orange-700">Offer/knowledge APIs don't verify resource ownership - users can access others' data</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">Admin API Exposes Secrets</div>
                    <div class="text-xs text-orange-700">/api/admin/settings returns environment variables in response</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">SQL Injection Risk</div>
                    <div class="text-xs text-orange-700">Dynamic query construction in search endpoints without parameterization</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">XSS in Rich Text</div>
                    <div class="text-xs text-orange-700">Unsafe innerHTML rendering without DOMPurify sanitization</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">Insecure File Uploads</div>
                    <div class="text-xs text-orange-700">No MIME type validation, path traversal possible via filename</div>
                </div>
                <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <div class="font-semibold text-orange-800 text-sm">Session Management</div>
                    <div class="text-xs text-orange-700">No session timeout, no logout from all devices functionality</div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <h4 class="font-bold text-yellow-800 mb-3">Medium Severity (7 vulnerabilities)</h4>
            <div class="grid md:grid-cols-3 gap-2">
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">Weak password policies</span> - No complexity requirements
                </div>
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">Verbose error messages</span> - Stack traces exposed to users
                </div>
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">Vulnerable dependencies</span> - Outdated npm packages
                </div>
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">Missing CSP header</span> - No Content-Security-Policy
                </div>
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">No audit logging</span> - Admin actions not tracked
                </div>
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">Long JWT expiration</span> - Tokens valid too long
                </div>
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                    <span class="font-semibold">Missing email verification</span> - For sensitive actions
                </div>
            </div>
        </div>

        <div>
            <h4 class="font-bold text-blue-800 mb-3">Low Severity (5 vulnerabilities)</h4>
            <div class="grid md:grid-cols-5 gap-2">
                <div class="p-2 bg-blue-50 border border-blue-200 rounded text-xs text-center">Missing SRI</div>
                <div class="p-2 bg-blue-50 border border-blue-200 rounded text-xs text-center">No account lockout</div>
                <div class="p-2 bg-blue-50 border border-blue-200 rounded text-xs text-center">SameSite cookies</div>
                <div class="p-2 bg-blue-50 border border-blue-200 rounded text-xs text-center">No security.txt</div>
                <div class="p-2 bg-blue-50 border border-blue-200 rounded text-xs text-center">Login rate limit</div>
            </div>
        </div>
    </div>
</div>
